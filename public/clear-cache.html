<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Limpiar Caché - Telegan Admin</title>
    <style>
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: #f8fafc;
            margin: 0;
            padding: 20px;
            color: #1e293b;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .status {
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            font-weight: 500;
        }
        .success { background: #dcfce7; color: #166534; border: 1px solid #bbf7d0; }
        .error { background: #fef2f2; color: #dc2626; border: 1px solid #fecaca; }
        .info { background: #eff6ff; color: #2563eb; border: 1px solid #dbeafe; }
        .warning { background: #fffbeb; color: #d97706; border: 1px solid #fed7aa; }
        button {
            background: #6dbe45;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: 500;
            cursor: pointer;
            margin: 10px 5px;
            transition: background 0.2s;
        }
        button:hover { background: #5aa835; }
        button.danger { background: #ef4444; }
        button.danger:hover { background: #dc2626; }
        .log {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 15px;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 14px;
            max-height: 300px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>🧹 Limpieza de Caché - Telegan Admin</h1>
        
        <div class="status info">
            <strong>ℹ️ Información:</strong> Esta herramienta limpia el caché del navegador y fuerza la recarga de recursos del dashboard.
        </div>
        
        <h2>🔧 Acciones Disponibles:</h2>
        
        <button onclick="clearLocalStorage()">🗑️ Limpiar LocalStorage</button>
        <button onclick="clearSessionStorage()">🗑️ Limpiar SessionStorage</button>
        <button onclick="clearCookies()">🍪 Limpiar Cookies</button>
        <button onclick="hardReload()">🔄 Recarga Forzada</button>
        <button onclick="testAPI()" class="danger">🧪 Probar APIs</button>
        
        <h2>📊 Estado Actual:</h2>
        <div id="status-container">
            <div class="status info">Cargando estado del sistema...</div>
        </div>
        
        <h2>📝 Log de Acciones:</h2>
        <div id="log" class="log">Esperando acciones...\n</div>
        
        <h2>🔗 Enlaces de Prueba:</h2>
        <ul>
            <li><a href="dashboard.html" target="_blank">Dashboard Principal</a></li>
            <li><a href="api/alerts.php?tipo=resumen" target="_blank">API de Alertas</a></li>
            <li><a href="api/dashboard.php" target="_blank">API del Dashboard</a></li>
            <li><a href="api/operational.php" target="_blank">API Operacional</a></li>
        </ul>
    </div>

    <script>
        let logElement = document.getElementById('log');
        let statusContainer = document.getElementById('status-container');
        
        function log(message) {
            const timestamp = new Date().toLocaleTimeString();
            logElement.textContent += `[${timestamp}] ${message}\n`;
            logElement.scrollTop = logElement.scrollHeight;
            console.log(`[CACHE-CLEANER] ${message}`);
        }
        
        function updateStatus(message, type = 'info') {
            statusContainer.innerHTML = `<div class="status ${type}">${message}</div>`;
        }
        
        function clearLocalStorage() {
            try {
                localStorage.clear();
                log('✅ LocalStorage limpiado');
                updateStatus('LocalStorage limpiado correctamente', 'success');
            } catch (error) {
                log('❌ Error limpiando LocalStorage: ' + error.message);
                updateStatus('Error limpiando LocalStorage', 'error');
            }
        }
        
        function clearSessionStorage() {
            try {
                sessionStorage.clear();
                log('✅ SessionStorage limpiado');
                updateStatus('SessionStorage limpiado correctamente', 'success');
            } catch (error) {
                log('❌ Error limpiando SessionStorage: ' + error.message);
                updateStatus('Error limpiando SessionStorage', 'error');
            }
        }
        
        function clearCookies() {
            try {
                document.cookie.split(";").forEach(function(c) { 
                    document.cookie = c.replace(/^ +/, "").replace(/=.*/, "=;expires=" + new Date().toUTCString() + ";path=/"); 
                });
                log('✅ Cookies limpiadas');
                updateStatus('Cookies limpiadas correctamente', 'success');
            } catch (error) {
                log('❌ Error limpiando cookies: ' + error.message);
                updateStatus('Error limpiando cookies', 'error');
            }
        }
        
        function hardReload() {
            log('🔄 Iniciando recarga forzada...');
            updateStatus('Recargando página...', 'warning');
            
            // Limpiar caché y recargar
            if ('caches' in window) {
                caches.keys().then(function(names) {
                    names.forEach(function(name) {
                        caches.delete(name);
                    });
                });
            }
            
            setTimeout(() => {
                window.location.reload(true);
            }, 1000);
        }
        
        async function testAPI() {
            log('🧪 Probando APIs...');
            updateStatus('Probando APIs...', 'info');
            
            const apis = [
                'api/alerts.php?tipo=resumen',
                'api/dashboard.php',
                'api/operational.php'
            ];
            
            for (const api of apis) {
                try {
                    const response = await fetch(api);
                    const data = await response.json();
                    
                    if (data.success) {
                        log(`✅ ${api}: OK`);
                    } else {
                        log(`⚠️ ${api}: Success=false`);
                    }
                } catch (error) {
                    log(`❌ ${api}: Error - ${error.message}`);
                }
            }
            
            updateStatus('Prueba de APIs completada. Revisar log para detalles.', 'info');
        }
        
        // Estado inicial
        function checkInitialStatus() {
            const localStorageSize = JSON.stringify(localStorage).length;
            const sessionStorageSize = JSON.stringify(sessionStorage).length;
            const cookiesCount = document.cookie.split(';').filter(c => c.trim()).length;
            
            updateStatus(`
                <strong>Estado del Sistema:</strong><br>
                📦 LocalStorage: ${localStorageSize} bytes<br>
                💾 SessionStorage: ${sessionStorageSize} bytes<br>
                🍪 Cookies: ${cookiesCount} elementos<br>
                🌐 URL: ${window.location.href}
            `, 'info');
            
            log('🚀 Herramienta de limpieza de caché iniciada');
        }
        
        // Inicializar
        checkInitialStatus();
    </script>
</body>
</html>
